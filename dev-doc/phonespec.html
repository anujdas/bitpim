<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <!-- $Id$ -->
    <title>Supporting a phone in BitPim</title>
  </head>

  <body>
    <h1>Supporting a phone in BitPim</h1>

    <p>This document describes how to support a phone in BitPim.  The
    intention of the implementation behind BitPim is to allow both a
    GUI driven user interface as well as a command line driven one
    (although the latter has not been implemented).  It is also good
    abstraction to keep phone communication details and the actual UI
    etc seperate.

    <p>In the GUI version of BitPim, the UI operates in the main
    thread, and the phone communication code operates in a background
    thread.  This keeps the UI responsive and means the phone thread
    doesn't have to remember state and be event driven.  It also means
    that the phone thread cannot make any gui requests.  In the
    command line version, everything will run in the main (and only)
    thread.

    <p>You should browse through the source and become familiar with
    the layout and purpose of each module.  The developer page has
    links to the apidoc and cross-referenced source.  If there is a
    function with no or inadequate documentation, please point it out
    on the bitpim-devel list.  I consider that a bug and will fix it
    immediately.

    <h1>Example</h1>

    <p>The best example to look at is the LG VX4400.  This was the
    first phone implemented, and is the most feature complete.

    <h1>Your code</h1>

    <p>You should put the code that implements your phone into a file
    with the prefix com_ (for example com_lgvx4400.py).  The code
    executed in the communications thread should be a class named
    Phone.  You will want to multiply inherit from the base phone
    class (com_phone.Phone) as well as from other phone classes (eg
    com_brew.BrewProtocol).  There may also be a base class for the
    manufacturer of your phone since there is normally a lot in common
    for all models (for example com_lg is common for all LG phones).

    <p>The phone is always in a mode (starting with MODE_NONE).  You
    may add extra modes or more typically your base classes will.  For
    example com_brew adds MODE_BREW.  The modes are used to switch the
    phone into different modes (for example brew, phonebook, modem).
    com_phone.Phone defines the setmode function which changes to a
    new mode and documents how the mode transition happens.

    <p>You need to add a config value for your phone together with the
    basename of the module at the start of ConfigDialog in
    guiwidgets.py.

    <p>You will also likely need to describe the protocol used by your
    phone.  The protocol descriptions go in p_*.p files.  Run
    <code>protogen.py</code> to compile the .p files into .py

    <p>The file packetdescription.txt describes the format and
    functionality of the descriptions.  It is also highly recommended
    that you run analyser.py supplying various files in the examples
    directory.  This will give you and idea as to how the other phones
    work.  You can also use this to work on your description.

    <p>While running BitPim, you can turn on the protocol log view.
    If you press ctrl-alt-p the protocol analyser will appear.  If
    will import whatever text you had selected, or all of it if there
    was no selection.  You can also copy and paste the text to save
    for a file to put in examples.

    <p>It is a good idea to contribute some files to examples.  It
    lets other developers see what the protocol and record formats
    look like on your phone.  You should try to make the examples
    interesting and featureful.  For example for a phonebook record
    you may want to fill out every number to the maximum number of
    digits.  Since the files are public you should not use private
    data.

    <p>You also need a second class, named Profile.  All the methods
    in this class are called from the gui thread and are to do with
    gui interaction between the gui and your phone.  For example it
    munges phonebook data into a format suitable for the phone and can
    generate warnings.  It also returns what the size and format
    constraints are for images.

    <p>Many of the methods take a dictionary as a parameter.  Your
    methods are expected to return information by adding new keys and
    can consult other keys to get more information.

<h1>Calling convention</h1>

<pre>
- mention results/data dict parameter
</pre>

<h1>Phone requirements</h1>

<pre>
serials source and unique id stuff
</pre>

    <h1>Methods in your Phone class</h1>

<dl>

<dt>getfundamentals

<dd>This method should get any data off the phone that may be necessary
for other methods in the Phone or Profile classes to use when processing
data.

<p>In the LGVX4400 code, this method retrieves the wallpaper and ringtone
indices (needed to convert the wallpaper and ringtone names into numbers
as used in the phonebook and calendar).  It also gets hash of the ESN
of the phone.

<dt>getphonebook

<dd>This method retrieves the phonebook.  It should update the 'phonebook'
key with the phonebook.  Each entry in the dict should have a value in the
same format as specified in the top of phonebook.py.  The user interface
will then deal with merging or replacing of the results.

<dt>savephonebook

<dd>This method saves the phonebook to the phone.  By convention the 
convertphonebooktophone method in Profile will munge the phonebook
into something suitable for this method and save it back into the
phonebook key.

<p>You will probably also want to update the serials for each
entry (especially for new entries).  You can add a key named
serialupdates.  It is a list of tuple.  Each tuple consists
of the bitpim serial for an entry (sourcetype="bitpim") and
your serial update.  See the updateserials() function in
phonebook.py for more information.

</dl>
<pre>
getcalendar
savecalendar
getringtones
saveringtones
getwallpapers
savewallpapers
</pre>

    <h1>Methods in your Profile class</h1>

<pre>
convertphonebooktophone - don't conv wallpaper and ringtone names since they
    may be updated after call to this fun

</pre>

    <h1>Constants in your Profile class</h1>

    <h2>usbids</h2>

    <p>This is a list of tuples (vendorid, productid, interfacenumber) that
      correspond to the device.  You should include USB to serial converters.
      You must have an interface number for the device to accessible via
      libusb.  If you only work through OS device drivers then interfacenumber
      can be none.

    <p>The list should be in most preferred first.  Typically you would list
      direct USB connections before USB to serial converters.
      
    <h2>deviceclasses</h2>

    A tuple containing one or both of <code>"serial"</code> and <code>"modem"</code>.
    This is used to filter out interfaces for composite devices in the detection
    code.  For example the LG VX4400 presents both a modem interface and a serial
    interface.  BitPim can only talk to the serial interface as the modem interface
    only does modem stuff.  The Sanyo phones only present a modem interface.

    <h2>WALLPAPER_WIDTH WALLPAPER_HEIGHT</h2>
    
    <p>The normal width and height of wallpapers for use on the
    device.  These values are used for auto resizing when the user
    adds a new wallpaper (eg via drag and drop).  Wallpapers and
    images from the phone are not resized unless the user explicitly
    asks for it (ie you don't have to worry about camera images being
    resized to this size).

    <h2>MAX_WALLPAPER_BASENAME_LENGTH</h2>

    <p>The maximum length of a wallpaper filename extension.  Files
    added via BitPim will be truncated if necessary.

    <h2>WALLPAPER_FILENAME_CHARS</h2>

    <p>A list of acceptable characters in wallpaper filenames.  Any
    characters not in the list will be removed when files are added
    via BitPim.  If there are no upper case letters then names are
    converted to lowercase, and if there are no lowercase letters then
    names are converted to uppercase.

    <h2>WALLPAPER_CONVERT_FORMAT</h2>

    <p>The file extension that wallpapers are automatically converted
      to (without the dot).  Examples are 'bmp', 'jpg' and 'png'.

    <h1>Calling sequence</h1>
    
    <p>Remember that all methods in Phone are called in comms thread
    and all methods in Profile are called in gui thread.  If the user
    has selected multiple actions (eg write phonebook and ringtones)
    then Phone.getfundamentals is called only once first, all Profile
    methods are called, and then Phone methods are called.

    <h2>Reading phonebook</h2>
    
    <ul>
      <li>Phone.getfundamentals
      <li>Phone.getphonebook
    </ul>


    <h2>Writing phonebook</h2>

    <ul>
      <li>Phone.getfundamentals 
      <li>Profile.convertphonebooktophone
      <li>Phone.savephonebook
    </ul>

    <hr>
    <address><a href="mailto:rogerb@rogerbinns.com"></a></address>
<!-- Created: Thu Dec 04 20:37:58 Pacific Standard Time 2003 -->
<!-- hhmts start -->
Last modified: Sat Feb 19 22:57:24 Pacific Standard Time 2005
<!-- hhmts end -->
  </body>
</html>
